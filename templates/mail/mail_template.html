{% extends 'base.html' %}
{% load mail %}
{% block JS %}
    <script type='text/javascript' src="{{ STATIC_URL }}js/jquery-1.8.3.js"></script>
    <script type='text/javascript' src="{{ STATIC_URL }}js/jquery.dataTables.js"></script>
    <script type='text/javascript' src="{{ STATIC_URL }}js/arsh/arsh.js"></script>
    <script type='text/javascript' src="{{ STATIC_URL }}js/arsh/connectors.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}js/select2.js"></script>
    <script type="text/javascript">
        function addc(e){
            $("div.constrains").append("<input type=\"text\" class=\"filterr " +e+"\" style=\"width: 200px;direction: rtl\"/>")
        }
    </script>
    <script>
        $(document).ready(
         function()
            {
                $("input.filterr").select2({tags:[]});
                //filtering emails based on inputs of selects with class = filter
                $("input.filterr").change(function (e) {
                    var $fltrs = $('temp');
                    var $result = $("table.threads-table tr");
                    // collect the selected filters
                    $("input.filterr").each(function() {
                        $fltrs = $('temp');
                        if (this.value == "")
                            $fltrs = $("table.threads-table tr");
                        var st = JSON.stringify(this.value).replace('\"','').replace('\"','').split(',');
                        var source = "."+this.className.split(/\s+/)[1]+"-";
                        $.each((st),function(index,val){
                            if(this!="")
                                $fltrs = $fltrs.add($("table.threads-table tr"+source+this));
                        })
                        $result = $result.filter($fltrs);
                    });
                    $("table.threads-table tr").hide();
                    $result.show()
                }).change(); // here in case a drop-down has been pre-selected
            }

        );
        function log(e) {
            var f=$("<li>"+e+"</li>");
            $("#events_11").append(e);
            f.show()
        };


    </script>
{% endblock %}

    {% block CSS %}
    <link rel="stylesheet" href="{{ STATIC_URL }}css/mail.css" type="text/css" media="screen" />
    <link rel="stylesheet" href="{{ STATIC_URL }}css/jquery.dataTables_themeroller.css" type="text/css" media="screen" />
    <link rel="stylesheet" href="{{ STATIC_URL }}css/select2.css"/>

{% endblock %}

{% block title %}سامانه پیام‌رسانی{% endblock %}

{% block extra_head_js %}
    <script>
        function newLabel() {
            var targetElement = document.getElementById('newLabelForm');
            targetElement.style.display = 'block';
        }

        function showAddLabelForm() {
            var targetElement = document.getElementById('addLabelForm');
            targetElement.style.display = 'block';
        }

        function cancelOperation() {
            var targetElement = document.getElementById('newLabelForm');
            targetElement.style.display = 'none';
        }

        function cancelAddLabel() {
            var targetElement = document.getElementById('addLabelForm');
            targetElement.style.display = 'none';
        }
    </script>

{% endblock %}

{% block sidebar %}
    <hr/>
    <div id='header' class="Center">
        <img class="icon" alt="inbox" src="/static/i.hide()});images/icons/mail-2-64.png" width="40px" onclick='window.location = "{% url mail/home %}"' />
        <img class="icon" alt="compose" src="/static/images/icons/primo/email_compose.png" width="48px" onclick='window.location = "{% url mail/compose %}"' />
    </div>

    <hr/>
    <div class = "constrains" style="padding: 10px;">
    {# Two examples: #}
        نام انبار:
        <script type="text/javascript">window.addc('warehouse');</script>
        <BR/><BR/>
        نام تگ:
        <script type="text/javascript">window.addc('tag');</script>
    {# A filter can be added using above JS code. functino arg: class to be filtered #}
    </div>

    <form class="Center" method='POST' id="mail_search_form" action="{% url mail/search %}">
        {% csrf_token %}
        <div id="search-input-div" class="inline">
            <input id="search-tags2" type='text' name='keywords' />&nbsp;
        </div>
        <img id='mail-search' src="/static/images/search.png" width="40px" style="margin-bottom: -12px;" onclick="$('#mail_search_form').submit()" />
    </form>
    <hr/>

    <div id='labelsFrame' class="sidebar-labels-list fa rtl">
        {% label_list user %}
    </div>
    <br/>

    {#    <div id='labelFrame'>#}
    {#        <a onclick="newLabel();" style='cursor: pointer;'> +لیبل جدید </a><br/>#}
    {##}
    {#        <div id='newLabelForm' style="display:none;">#}
    {#            <dynamic_form method='POST' action="{% url mail/createLabel %}">#}
    {#                {% csrf_token %}#}
    {#                عنوان: <input type='text' name='title'>#}
    {#                <input type='submit' value='ایجاد' name='create'>#}
    {#                <input type='button' value='لغو' name='cancel' onclick="cancelOperation()">#}
    {#            </dynamic_form>#}
    {#        </div>#}
    {#    </div>#}
    {#    <br/>#}
{% endblock %}
